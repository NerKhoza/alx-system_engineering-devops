#!/usr/bin/env bash

# Check if the user has root privileges
if [[ $EUID -ne 0 ]]; then
    echo "This script needs to be run with root privileges (sudo)."
    exit 1
fi

# Display headers
echo "Listening Ports Information:"
echo "----------------------------------------"
echo "PID   |   Port   |   Program"
echo "----------------------------------------"

# Get listening sockets information using netstat
netstat -tuln | grep LISTEN | awk '{print $4}' | while read -r line; do
    port=$(echo "$line" | awk -F':' '{print $2}')
    pid=$(lsof -i :$port -t 2>/dev/null)
    program=$(lsof -i :$port -c -n -P -Fn | grep '^n' | cut -c 2-)

    # Display the information
    echo "$pid   |   $port   |   $program"
done

echo "----------------------------------------"

